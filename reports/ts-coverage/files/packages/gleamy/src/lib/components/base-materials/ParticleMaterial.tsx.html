
  <!DOCTYPE html>
  <html>
    <head>
      <title>ParticleMaterial.tsx</title>
      <link href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css" type="text/css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js" type="text/javascript" charset="utf-8"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js" type="text/javascript" charset="utf-8"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css" type="text/css" rel="stylesheet">
<script src="../../../../../../../assets/source-file.js" type="text/javascript" charset="utf-8"></script>
<link href="../../../../../../../assets/source-file.css" type="text/css" rel="stylesheet">
    </head>
    <body>
    <div style="margin-top:3em" class="ui container"><h1 class="ui header"><a href="../../../../../../../index.html">TypeScript coverage report</a></h1><table style="margin-top:2em" class="ui celled table"><thead class=""><tr class=""><th class="">Filename</th><th class="">Percent</th><th class="">Threshold</th><th class="">Total</th><th class="">Covered</th><th class="">Uncovered</th></tr></thead><tbody class=""><tr class="positive"><td class="">packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx</td><td class="">88.50%</td><td class="">80%</td><td class="">426</td><td class="">377</td><td class="">49</td></tr></tbody></table><textarea id="editor" readonly="" style="margin-top:3em">import { type FC, useEffect, useCallback, useContext, useRef } from &#x27;react&#x27;;
import { setDPI } from &#x27;../../utils/setDPI&#x27;;
import { type TParticle } from &#x27;../../../types&#x27;;
import { GleamyContext } from &#x27;../../provider&#x27;;
import { drawMaterial } from &#x27;../../utils/drawMaterial&#x27;;

interface CreateParticles {
  depth: number;
  particleAmount: number;
  particleSize: number;
  elementWidth: number;
  elementHeight: number;
}

type ParticleLayer = [number, number, number, number, number, boolean];

const createParticles = ({
  depth,
  particleAmount,
  particleSize,
  elementWidth,
  elementHeight,
}: CreateParticles): ParticleLayer[][] =&gt; {
  const particleAmountPerLayer = Math.floor(particleAmount / depth);
  const particleLayers = Array(depth)
    .fill(0)
    .map(() =&gt; {
      const particleLayer = [] as ParticleLayer[];

      for (let i = 0; i &lt;= particleAmountPerLayer; i += 1) {
        const dotX = Math.floor(Math.random() * elementWidth);
        const dotY = Math.floor(Math.random() * elementHeight);
        const particleInformation = [
          dotX,
          dotY,
          particleSize,
          0,
          Math.PI * 2,
          false,
        ] as ParticleLayer;
        particleLayer.push(particleInformation);
      }

      return particleLayer;
    });

  return particleLayers;
};

export const ParticleMaterial: FC&lt;TParticle&gt; = ({
  clipPathRef = null,
  width = 100,
  height = 100,
  acceleration = 1,
  material,
  className = undefined,
  particleCoverage = 5,
  particleSize = 1,
  depth = 25,
  particleColor = &#x27;#ff9300&#x27;,
  depthAlpha = false,
  rendering = true,
  backgroundColor = &#x27;black&#x27;,
  clipPathScale = 1,
  intensity = 0.5,
  hueRotationSpeed = 1,
  animator,
  ...props
}) =&gt; {
  const gleamyProvider = useContext(GleamyContext);
  const canvasRef = useRef&lt;HTMLCanvasElement&gt;(null);
  const clipPaths = useRef&lt;string[]&gt;([]);
  const particles = useRef&lt;ParticleLayer[][]&gt;([]);
  const particleDepthLayers =
    Array.isArray(particleColor) &amp;&amp; particleColor.length &gt; depth
      ? particleColor.length
      : depth;

  const memoizedCanvas = useCallback(
    (canvasReference: HTMLCanvasElement) =&gt; {
      if (canvasReference === null) {
        return {
          canvas: null,
          context: null,
          position: { top: 0, left: 0 },
          elementWidth: 0,
          elementHeight: 0,
        };
      }

      const canvas = canvasReference;
      const context = canvas.getContext(&#x27;2d&#x27;, {
        alpha: true,
        desynchronized: true,
        willReadFrequently: true,
      });
      const position = canvasReference.getBoundingClientRect();
      setDPI(canvas, (gleamyProvider?.devicePixelRatio || 1) * 96);

      const elementWidth = canvasReference.width;
      const elementHeight = canvasReference.height;

      const maxParticleAmount = (elementHeight * elementWidth) / particleSize;
      const particleAmount =
        (maxParticleAmount / 100) *
        (particleCoverage &gt; 100 ? 100 : particleCoverage);

      if (particles.current.length === 0) {
        const newParticles = createParticles({
          depth: particleDepthLayers,
          particleAmount,
          particleSize,
          elementWidth,
          elementHeight,
        });
        particles.current = [...newParticles];
      }

      return { canvas, context, position, elementWidth, elementHeight };
    },
    [particleCoverage, particleSize, depth, gleamyProvider.devicePixelRatio],
  );

  useEffect(() =&gt; {
    if (clipPathRef?.current) {
      const paths = Object.values(clipPathRef.current.querySelectorAll(&#x27;path&#x27;));
      clipPaths.current = []; // reset
      paths.forEach((path: SVGPathElement) =&gt; {
        const d = path.getAttribute(&#x27;d&#x27;) || undefined;
        if (d) {
          clipPaths.current.push(d);
        }
      });
    }
  }, [clipPathRef, clipPaths]);

  const createClipPath = useCallback(
    (context: CanvasRenderingContext2D) =&gt; {
      context.save();
      clipPaths.current.forEach((path) =&gt; {
        context.beginPath();
        context.scale(clipPathScale, clipPathScale);
        const p = new Path2D(path);
        context.closePath();
        context.clip(p);
      });
    },
    [clipPaths, clipPathScale],
  );

  const render = useCallback(() =&gt; {
    if (!canvasRef.current) {
      return;
    }

    const { context, position, elementWidth, elementHeight } = memoizedCanvas(
      canvasRef.current,
    );

    if (context === null || !gleamyProvider.defaultAnimator) {
      return;
    }

    let xY;
    const { animators } = gleamyProvider;
    const defaultAnimator = animators
      ? animators[gleamyProvider.defaultAnimator || &#x27;mouseMove&#x27;]
      : { x: 0, y: 0 };

    if (animator &amp;&amp; typeof animator === &#x27;string&#x27;) {
      xY = animators ? animators[`${animator}`] : defaultAnimator;
    } else if (animator &amp;&amp; typeof animator === &#x27;function&#x27;) {
      xY = animator();
    } else {
      xY = defaultAnimator;
    }

    const toPosX = xY.x ** acceleration || 1;
    const toPosY = xY.y ** acceleration || 1;

    const toY = Math.floor(toPosY - position.top + elementHeight);
    const toX = Math.floor(toPosX - position.left + elementWidth);
    const fromX = -toY - elementHeight * 2;
    const fromY = -toX - elementWidth * 2;

    context.clearRect(0, 0, elementWidth, elementHeight);

    if (backgroundColor) {
      context.fillStyle = backgroundColor.toString();
      context.fillRect(0, 0, elementWidth, elementHeight);
    }

    context.save();

    if (clipPathRef &amp;&amp; context) {
      createClipPath(context);
    }

    particles.current.forEach((layer, index) =&gt; {
      const selectedParticleColor = Array.isArray(particleColor)
        ? particleColor[index % particleColor.length]
        : particleColor;

      const rotationDegrees = Math.floor(
        (360 / particles.current.length) * index,
      );
      const depthPercentage = (1 / depth) * (index + 1);

      context.fillStyle = material({
        context,
        pos1X: (index % 2 === 0 ? toX + 50 : fromX + 50) + rotationDegrees,
        pos1Y: (index % 2 === 0 ? toY + 50 : fromY + 50) + rotationDegrees,
        particleColor: selectedParticleColor?.toString() ?? &#x27;white&#x27;,
        depthPercentage,
        depthAlpha,
        intensity,
        hueRotationSpeed,
      });

      context.save();
      context.setTransform(1, 0, 0, 1, 0, 0);
      const addedMarginWidth = elementWidth / 2;
      const addedMarginHeight = elementHeight / 2;
      context.translate(addedMarginWidth, addedMarginHeight);
      context.translate(-addedMarginWidth, -addedMarginHeight);

      const beginPath = context.beginPath.bind(context);
      const arc = context.arc.bind(context);
      const fill = context.fill.bind(context);

      layer.forEach((particle: ParticleLayer) =&gt; {
        beginPath();
        arc(...particle);
        fill();
      });
      context.restore();
    });
  }, [
    intensity,
    acceleration,
    material,
    depthAlpha,
    createClipPath,
    memoizedCanvas,
    clipPathRef,
    particleColor,
    rendering,
    depth,
    hueRotationSpeed,
    gleamyProvider,
  ]);

  useEffect(() =&gt; {
    if (rendering) {
      const fps = gleamyProvider?.fps || 60;
      drawMaterial({ drawFunction: render, fps });
    }
  }, [gleamyProvider, render, rendering]);

  return (
    &lt;canvas
      ref={canvasRef}
      className={className}
      width={width}
      height={height}
      {...props}
    /&gt;
  );
};
</textarea><pre id="annotations" style="display:none">[{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:155,&quot;character&quot;:12,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:159,&quot;character&quot;:8,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:163,&quot;character&quot;:8,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:170,&quot;character&quot;:6,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:172,&quot;character&quot;:6,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:174,&quot;character&quot;:6,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:177,&quot;character&quot;:19,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:177,&quot;character&quot;:22,&quot;text&quot;:&quot;x&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:178,&quot;character&quot;:19,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:178,&quot;character&quot;:22,&quot;text&quot;:&quot;y&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:185,&quot;character&quot;:4,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:185,&quot;character&quot;:12,&quot;text&quot;:&quot;clearRect&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:188,&quot;character&quot;:6,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:188,&quot;character&quot;:14,&quot;text&quot;:&quot;fillStyle&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:189,&quot;character&quot;:6,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:189,&quot;character&quot;:14,&quot;text&quot;:&quot;fillRect&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:192,&quot;character&quot;:4,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:192,&quot;character&quot;:12,&quot;text&quot;:&quot;save&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:194,&quot;character&quot;:23,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:208,&quot;character&quot;:6,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:208,&quot;character&quot;:14,&quot;text&quot;:&quot;fillStyle&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:219,&quot;character&quot;:6,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:219,&quot;character&quot;:14,&quot;text&quot;:&quot;save&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:220,&quot;character&quot;:6,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:220,&quot;character&quot;:14,&quot;text&quot;:&quot;setTransform&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:223,&quot;character&quot;:6,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:223,&quot;character&quot;:14,&quot;text&quot;:&quot;translate&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:224,&quot;character&quot;:6,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:224,&quot;character&quot;:14,&quot;text&quot;:&quot;translate&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:226,&quot;character&quot;:12,&quot;text&quot;:&quot;beginPath&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:226,&quot;character&quot;:24,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:226,&quot;character&quot;:32,&quot;text&quot;:&quot;beginPath&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:226,&quot;character&quot;:42,&quot;text&quot;:&quot;bind&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:226,&quot;character&quot;:47,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:227,&quot;character&quot;:12,&quot;text&quot;:&quot;arc&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:227,&quot;character&quot;:18,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:227,&quot;character&quot;:26,&quot;text&quot;:&quot;arc&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:227,&quot;character&quot;:30,&quot;text&quot;:&quot;bind&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:227,&quot;character&quot;:35,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:228,&quot;character&quot;:12,&quot;text&quot;:&quot;fill&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:228,&quot;character&quot;:19,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:228,&quot;character&quot;:27,&quot;text&quot;:&quot;fill&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:228,&quot;character&quot;:32,&quot;text&quot;:&quot;bind&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:228,&quot;character&quot;:37,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:231,&quot;character&quot;:8,&quot;text&quot;:&quot;beginPath&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:232,&quot;character&quot;:8,&quot;text&quot;:&quot;arc&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:233,&quot;character&quot;:8,&quot;text&quot;:&quot;fill&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:235,&quot;character&quot;:6,&quot;text&quot;:&quot;context&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/ParticleMaterial.tsx&quot;,&quot;line&quot;:235,&quot;character&quot;:14,&quot;text&quot;:&quot;restore&quot;,&quot;kind&quot;:1}]</pre></div>
    <p class="footer-text">TypeScript Coverage Report generated by <a href="https://github.com/plantain-00/type-coverage">type-coverage</a> and <a href="https://github.com/alexcanessa/typescript-coverage-report">typescript-coverage-report</a> at Sun, 24 Sep 2023 08:50:30 GMT</p>
    </body>
  </html>
  