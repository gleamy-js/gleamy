<!doctype html>
<html>
  <head>
    <title>GradientMaterial.tsx</title>
    <link
      href="https://cdn.jsdelivr.net/npm/semantic-ui@2.4.2/dist/semantic.min.css"
      type="text/css"
      rel="stylesheet"
    />
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.js"
      type="text/javascript"
      charset="utf-8"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/mode/javascript/javascript.min.js"
      type="text/javascript"
      charset="utf-8"
    ></script>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.58.2/codemirror.min.css"
      type="text/css"
      rel="stylesheet"
    />
    <script
      src="../../../../../../../assets/source-file.js"
      type="text/javascript"
      charset="utf-8"
    ></script>
    <link
      href="../../../../../../../assets/source-file.css"
      type="text/css"
      rel="stylesheet"
    />
  </head>
  <body>
    <div style="margin-top: 3em" class="ui container">
      <h1 class="ui header">
        <a href="../../../../../../../index.html">TypeScript coverage report</a>
      </h1>
      <table style="margin-top: 2em" class="ui celled table">
        <thead class="">
          <tr class="">
            <th class="">Filename</th>
            <th class="">Percent</th>
            <th class="">Threshold</th>
            <th class="">Total</th>
            <th class="">Covered</th>
            <th class="">Uncovered</th>
          </tr>
        </thead>
        <tbody class="">
          <tr class="positive">
            <td class="">
              packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx
            </td>
            <td class="">94.83%</td>
            <td class="">80%</td>
            <td class="">387</td>
            <td class="">367</td>
            <td class="">20</td>
          </tr>
        </tbody>
      </table>
      <textarea id="editor" readonly="" style="margin-top: 3em">
import { FC, useEffect, useCallback, useRef, useContext } from &quot;react&quot;;
import { setDPI } from &quot;../../utils/setDPI&quot;;
import { TStaticGradient, TDynamicGradient } from &quot;../../../types&quot;;
import { GleamyContext } from &quot;../../provider&quot;;
import { drawMaterial } from &quot;../../utils/drawMaterial&quot;;

export const GradientMaterial: FC&lt;TStaticGradient | TDynamicGradient&gt; = ({
  animator,
  width = 100,
  height = 100,
  noFill = false,
  spread = 0.5,
  acceleration = 0.9,
  material,
  clipPathRef = null,
  className = undefined,
  edgeThickness = 0,
  rendering = true,
  clipPathScale = 1,
  backgroundColor,
  translucency = undefined,
  hueRotationSpeed = undefined,
  foilVisibility = undefined,
  ...props
}) =&gt; {
  const gleamyProvider = useContext(GleamyContext);

  const canvasRef = useRef&lt;HTMLCanvasElement&gt;(null);
  const clipPaths = useRef&lt;string[]&gt;([]);

  const memoizedCanvas = useCallback(
    (canvasReference: HTMLCanvasElement) =&gt; {
      if (canvasReference === null) {
        return {
          canvas: null,
          context: null,
          elementWidth: 0,
          elementHeight: 0,
        };
      }

      const canvas = canvasReference;
      const context = canvas.getContext(&quot;2d&quot;, {
        alpha: true,
        desynchronized: true,
        willReadFrequently: true,
      });

      const elementWidth = canvasReference.width;
      const elementHeight = canvasReference.height;

      setDPI(canvas, (gleamyProvider?.devicePixelRatio || 1) * 96);

      return { canvas, context, elementWidth, elementHeight };
    },
    [gleamyProvider.devicePixelRatio],
  );

  useEffect(() =&gt; {
    if (clipPathRef?.current) {
      const paths = Object.values(clipPathRef.current.querySelectorAll(&quot;path&quot;));
      clipPaths.current = []; // reset
      paths.forEach((path: SVGPathElement) =&gt; {
        const d = path.getAttribute(&quot;d&quot;) || undefined;
        if (d) {
          clipPaths.current.push(d);
        }
      });
    }
  }, [clipPathRef]);

  const createClipPath = useCallback(
    (context: CanvasRenderingContext2D) =&gt; {
      context.save();
      clipPaths.current.forEach((path) =&gt; {
        context.beginPath();
        context.scale(clipPathScale, clipPathScale);
        const p = new Path2D(path);
        context.closePath();
        context.clip(p);
      });
    },
    [clipPaths, clipPathScale],
  );

  const createEdge = useCallback(
    (context: CanvasRenderingContext2D) =&gt; {
      if (!(context &amp;&amp; edgeThickness)) {
        return;
      }

      context.lineWidth = edgeThickness;
      context.save();
      context.beginPath();
      clipPaths.current.forEach((path) =&gt; {
        const p = new Path2D(path);
        context.stroke(p);
      });
      context.closePath();
      context.restore();
    },
    [edgeThickness, clipPaths, gleamyProvider.devicePixelRatio],
  );

  const render = useCallback(() =&gt; {
    if (!canvasRef.current) {
      return null;
    }

    const { context, elementWidth, elementHeight } = memoizedCanvas(
      canvasRef.current,
    );

    if (!context) {
      return;
    }

    let xY;
    const { animators } = gleamyProvider;
    const defaultAnimator = animators
      ? animators[gleamyProvider.defaultAnimator || &quot;mouseMove&quot;]
      : { x: 0, y: 0 };

    if (animator &amp;&amp; typeof animator === &quot;string&quot;) {
      xY = animators ? animators[animator] : defaultAnimator;
    } else if (animator &amp;&amp; typeof animator === &quot;function&quot;) {
      xY = animator();
    } else {
      xY = defaultAnimator;
    }

    const toPosX = xY.x ** acceleration || 1;
    const toPosY = xY.y ** acceleration || 1;

    const toY = toPosY;
    const toX = toPosX;

    const fromX = -toY - elementWidth * 2;
    const fromY = -toX - elementHeight * 2;

    context.clearRect(0, 0, elementWidth, elementHeight);

    if (backgroundColor) {
      context.fillStyle = backgroundColor.toString();
      context.fillRect(0, 0, elementWidth, elementHeight);
    }

    context.save();

    const createdMaterial = material({
      context,
      pos0X: fromX,
      pos0Y: fromY,
      pos1X: toPosX,
      pos1Y: toPosY,
      animatorX: xY.x,
      animatorY: xY.y,
      spread,
      translucency: typeof translucency === &quot;number&quot; ? translucency : undefined,
      hueRotationSpeed:
        typeof hueRotationSpeed === &quot;number&quot; ? hueRotationSpeed : undefined,
      foilVisibility:
        typeof foilVisibility === &quot;number&quot; ? foilVisibility : undefined,
    });

    if (clipPathRef) {
      createClipPath(context);
    }

    if (!noFill) {
      context.save();
      context.beginPath();
      context.fillStyle = createdMaterial;
      context.fillRect(0, 0, elementWidth, elementHeight);
      context.closePath();
      context.restore();
    }

    if (edgeThickness &amp;&amp; clipPathRef) {
      context.strokeStyle = material({
        context,
        pos0X: fromY,
        pos0Y: fromX,
        pos1X: toPosX,
        pos1Y: toPosY,
        animatorX: xY.y,
        animatorY: xY.x,
        spread,
        translucency:
          typeof translucency === &quot;number&quot; ? translucency : undefined,
        hueRotationSpeed:
          typeof hueRotationSpeed === &quot;number&quot; ? hueRotationSpeed : undefined,
        foilVisibility:
          typeof foilVisibility === &quot;number&quot; ? foilVisibility : undefined,
      });
      createEdge(context);
    } else if (edgeThickness) {
      const createdMaterialInversed = material({
        context,
        pos0X: fromY,
        pos0Y: fromX,
        pos1X: toPosX,
        pos1Y: toPosY,
        animatorX: xY.y,
        animatorY: xY.x,
        spread,
      });
      context.strokeStyle = createdMaterialInversed;
      context.save();
      context.beginPath();
      context.lineWidth = edgeThickness;
      context.fillStyle = createdMaterialInversed;

      context.rect(
        0,
        0,
        elementWidth / (gleamyProvider?.devicePixelRatio || 1),
        elementHeight / (gleamyProvider?.devicePixelRatio || 1),
      );

      context.stroke();
      context.closePath();
      context.restore();
    }
  }, [
    noFill,
    acceleration,
    material,
    createClipPath,
    memoizedCanvas,
    createEdge,
    clipPathRef,
    spread,
    edgeThickness,
    gleamyProvider,
    backgroundColor,
  ]);

  useEffect(() =&gt; {
    if (rendering) {
      const fps = gleamyProvider?.fps || 60;
      drawMaterial({ drawFunction: render, fps });
    }
  }, [gleamyProvider, render, rendering]);

  return (
    &lt;canvas
      ref={canvasRef}
      className={className}
      width={width}
      height={height}
      {...props}
    /&gt;
  );
};
</textarea
      >
      <pre id="annotations" style="display: none">
[{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:117,&quot;character&quot;:8,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:124,&quot;character&quot;:6,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:126,&quot;character&quot;:6,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:128,&quot;character&quot;:6,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:131,&quot;character&quot;:19,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:131,&quot;character&quot;:22,&quot;text&quot;:&quot;x&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:132,&quot;character&quot;:19,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:132,&quot;character&quot;:22,&quot;text&quot;:&quot;y&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:155,&quot;character&quot;:17,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:155,&quot;character&quot;:20,&quot;text&quot;:&quot;x&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:156,&quot;character&quot;:17,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:156,&quot;character&quot;:20,&quot;text&quot;:&quot;y&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:185,&quot;character&quot;:19,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:185,&quot;character&quot;:22,&quot;text&quot;:&quot;y&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:186,&quot;character&quot;:19,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:186,&quot;character&quot;:22,&quot;text&quot;:&quot;x&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:203,&quot;character&quot;:19,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:203,&quot;character&quot;:22,&quot;text&quot;:&quot;y&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:204,&quot;character&quot;:19,&quot;text&quot;:&quot;xY&quot;,&quot;kind&quot;:1},{&quot;file&quot;:&quot;packages/gleamy/src/lib/components/base-materials/GradientMaterial.tsx&quot;,&quot;line&quot;:204,&quot;character&quot;:22,&quot;text&quot;:&quot;x&quot;,&quot;kind&quot;:1}]</pre
      >
    </div>
    <p class="footer-text">
      TypeScript Coverage Report generated by
      <a href="https://github.com/plantain-00/type-coverage">type-coverage</a>
      and
      <a href="https://github.com/alexcanessa/typescript-coverage-report"
        >typescript-coverage-report</a
      >
      at Fri, 22 Sep 2023 14:29:26 GMT
    </p>
  </body>
</html>
